@using BlazorPracticeServer.Components.Enums

<BSModal @ref="ConfirmationModal" Size="Size.Large">
    <BSModalHeader OnClick="@(() => ConfirmationModal.Hide())">Modal title</BSModalHeader>

    <BSModalBody>

        @ChildContent

        @if (ConfirmType == ConfirmType.Edit)
        {
            <EditForm Model="@MovieToEdit">
                <InputText placeholder = "@MovieToEdit.Title" @bind-Value=@MovieTitleInput />
                <InputDate TValue="DateTime" @bind-Value=@MovieReleaseDateInput />
            </EditForm>
        }

    </BSModalBody>
    <BSModalFooter>

        @* Button *@
        <BSButton Color="@Color.Secondary" @onclick="@(() => ConfirmationModal.Hide())">Cancel</BSButton>
        <BSButton Color="@Color.Primary" @onclick="@HandleConfirmBtnClick">Confirm</BSButton>
    </BSModalFooter>
</BSModal>


@code {

    BSModal ConfirmationModal { get; set; }

    [Parameter]
    public Movie MovieToEdit { get; set; }
    [Parameter]
    public string Title { get; set; }
    [Parameter]
    public RenderFragment ChildContent { get; set; }
    [Parameter]
    public EventCallback OnDeleteConfirm { get; set; }
    [Parameter]
    public EventCallback OnEditConfirm { get; set; }
    [Parameter]
    public EventCallback OnCancel { get; set; }


    public string MovieTitleInput { get; set; }

    public DateTime MovieReleaseDateInput { get; set; }

    public ConfirmType ConfirmType { get; set; }

    private bool _displayConfirmation = false;

    public async Task Show(Movie? movie)
    {
        await AssignPlaceholder(movie);

        ConfirmationModal.Show();
    }

    private async Task AssignPlaceholder(Movie? movie)
    {
        MovieTitleInput = movie.Title;
        MovieReleaseDateInput = movie.ReleaseDate;
        StateHasChanged();
    }

    public void Hide() => ConfirmationModal.Hide();

    public async Task HandleConfirmBtnClick()
    {
        if (ConfirmType == ConfirmType.Delete)
        {
            OnDeleteConfirm.InvokeAsync();
        }
        else
        {
            MovieToEdit.Title = MovieTitleInput;
            MovieToEdit.ReleaseDate = MovieReleaseDateInput;

            OnEditConfirm.InvokeAsync();
        }
    }


    public void SaveChanges()
    {

    }
}